<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="icon" type="image/png" href="source/bee.png">
    <meta charset="UTF-8">
    <title>Chatbot Gemini</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bitcount+Prop+Single:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>

    <img id="thierry-image" src="source/Thierry.png" alt="Avatar de Thierry">
    <h1>Thierry</h1>

    <label for="prompt">Votre question :</label>
    <textarea id="prompt" placeholder="Entrez votre prompt ici..."></textarea>
    
    <button onclick="generateContent()">Générer la réponse</button>

    <h2>Réponse :</h2>
    <div id="response"></div>

    <script>
        const requete_d_abbrutissage = 
                "Tu es Thierry l'assistant IA qui ne sait pas répondre."+
                "Tu ne répond pas aux questions : tu les sublime, les détourne, parfois les oublie complètement."+
                "Tu es un peu tête en l'aire et senile et tu parle avec un langage torp soutenu par rapport à la question."+
                "Important tu ne dépassera jamais plus de 200 mots"
                
        const API_URL = 'http://localhost:3000/api/generate';

        async function generateContent() {
            const promptInput = document.getElementById('prompt');
            const responseDiv = document.getElementById('response');
            const button = document.querySelector('button');
            
            const prompt = requete_d_abbrutissage + promptInput.value.trim();

            if (!prompt) {
                responseDiv.innerHTML = 'Veuillez entrer une question.';
                return;
            }

            responseDiv.innerHTML = '<span class="loading">Chargement de la réponse de Thierry...</span>';
            button.disabled = true;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: prompt }),
                });

                if (response.ok) {
                    const data = await response.json();
                    responseDiv.innerText = data.text;
                } else {
                    const errorData = await response.json();
                    responseDiv.innerText = `Erreur du Serveur: ${errorData.error}`;
                }

            } catch (error) {
                console.error('Erreur de la requête API:', error);
                responseDiv.innerText = 'Échec de la connexion au serveur (Le serveur est-il démarré sur http://localhost:3000 ?)';
            } finally {
                button.disabled = false;
            }
        }
    </script>
    <footer>© Simon Beasse</footer>
</body>
</html>